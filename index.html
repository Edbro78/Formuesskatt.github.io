<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator for Formuesskatt</title>

<!-- Tailwind CSS for styling -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Google Fonts: Inter -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Generelle Stiler --- */
        html, body {
            height: 100%; /* Sikrer at html og body tar hele viewport-høyden */
            margin: 0;
            overflow-x: hidden; /* Forhindrer horisontal scrollbar */
            overflow-y: hidden; /* Forhindrer vertikal scrollbar på hovedsiden, innhold i bokser kan scrolle om nødvendig */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #E5E7EB; /* light-text */
        }

        /* --- Sidenavigasjon --- */
        .page {
            display: none;
            height: 100%; /* Sikrer at hver side tar full høyde */
        }
        .page.active {
            display: block;
        }

        /* --- Dashboard Spesifikke Stiler --- */
        .dashboard-container {
            --dark-blue: #1A2A47;
            --accent-blue-light: #60A5FA;
            --accent-blue-vibrant: #00A9E0;
            --card-bg: #24385B;
            --light-text: #E5E7EB;
            --medium-text: #CBD5E1;
            --border-color: #364A6E;
            background-color: var(--dark-blue);
            padding-top: 0.1rem; 
            padding-bottom: 0.1rem; 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-start; 
            height: 100%; /* Tar full høyde av foreldreelementet (body) */
        }
        @media (min-width: 1024px) { /* lg breakpoint */
            .dashboard-container {
                padding-top: 0.2rem; 
                padding-bottom: 0.2rem; 
            }
        }
        
        /* Stil for hovedresultatverdiene */
        .output-value {
            font-size: 1.8rem; /* Større font for å fylle plassen bedre (original i forrige svar) */
            font-weight: 700;
            color: var(--accent-blue-vibrant);
            word-break: break-word;
        }

        .output-label {
            font-size: 0.75rem; /* Større font for bedre lesbarhet (original i forrige svar) */
            color: var(--medium-text);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Felles stil for nummerinput */
        input[type="text"].asset-input {
            -moz-appearance: textfield;
            background-color: #1e293b; /* slate-800 */
            border: 1px solid var(--border-color);
            border-radius: 0.25rem; 
            padding: 0.15rem 0.3rem; /* Økt padding med 50% for gjeld-feltet */
            color: var(--light-text);
            width: 100%;
            font-size: 0.9rem; /* Økt fontstørrelse med 50% for gjeld-feltet */
        }
        input[type="text"].asset-input:focus {
            outline: none;
            border-color: var(--accent-blue-light);
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.5);
        }
        input[type="text"].asset-input::placeholder {
            color: #475569; /* slate-600 */
        }
        
        /* --- Slider stiler --- */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 2px; /* Ytterligere redusert høyde på slideren */
            background: #1e293b; /* slate-800 */
            border-radius: 3px; 
            outline: none;
            transition: background 0.3s, opacity 0.2s;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 10px; /* Ytterligere redusert thumb-størrelse */
            height: 10px; /* Ytterligere redusert thumb-størrelse */
            background: var(--accent-blue-light);
            cursor: pointer;
            border-radius: 50%;
            border: 1px solid var(--dark-blue); 
            margin-top: -4px; /* Juster for å sentrere thumb på den tynnere slideren */
        }
        input[type="range"]::-moz-range-thumb {
            width: 10px; 
            height: 10px; 
            background: var(--accent-blue-light);
            cursor: pointer;
            border-radius: 50%;
            border: 1px solid var(--dark-blue);
        }
        
        /* Side 2 Tabellstiler */
        .rate-table-container {
            background-color: var(--card-bg);
            padding: 0.4rem; 
            border-radius: 0.75rem;
        }
        .rate-table-as {
            background-color: #1e3a8a; 
        }
        .rate-table-header {
            display: grid;
            /* Justerer grid-kolonner for bedre passform på mindre effektive oppløsninger */
            grid-template-columns: minmax(65px, 1.5fr) repeat(4, minmax(40px, 1fr)); 
            gap: 0.2rem; 
            color: var(--medium-text);
            font-weight: 600;
            padding-bottom: 0.2rem; 
            border-bottom: 1px solid var(--border-color);
            font-size: 0.65rem; 
            text-align: right; 
        }
        .rate-table-header > div:first-child {
            text-align: left; 
        }
        .rate-table-row {
            display: grid;
            /* Justerer grid-kolonner for bedre passform på mindre effektive oppløsninger */
            grid-template-columns: minmax(65px, 1.5fr) repeat(4, minmax(40px, 1fr)); 
            gap: 0.2rem; 
            padding: 0.25rem 0; 
            border-bottom: 1px solid var(--border-color);
            font-size: 0.65rem; 
        }
        .rate-table-row:last-child {
            border-bottom: none;
        }
        .rate-table-row-label {
            font-weight: 500;
            color: var(--light-text);
            text-align: left; 
        }
        .rate-table-cell {
            text-align: right;
        }
        .rate-table-final-row {
            font-size: 0.7rem; 
            font-weight: 700;
            color: white;
            background-color: rgba(0, 0, 0, 0.2);
            margin: 0 -0.4rem; 
            padding: 0.3rem 0.4rem; 
        }
        /* Custom scrollbar for better appearance on overflow content */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #60A5FA;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #3b82f6;
        }

    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="antialiased">

<!-- =========== SIDE 1: FORMUESSKATTKALKULATOR =========== -->
<div id="page1" class="page active">
<div class="dashboard-container w-full flex flex-col items-center justify-center p-4 lg:p-8">
<div class="w-full max-w-6xl mx-auto h-full flex flex-col justify-between"> <!-- Lagt til h-full flex flex-col justify-between -->
<header class="text-center mb-1"> 
<h1 class="text-xl md:text-2xl font-bold text-white mb-0.5">Beregning av Formuesskatt</h1> 
<p class="text-slate-400 text-xs">Beregn din formuesskatt og se hva som kreves for å bevare kjøpekraften.</p> 
</header>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-2 flex-grow"> <!-- Lagt til flex-grow her -->
<!-- Kolonne 1: Input -->
<div class="lg:col-span-1 space-y-1.5 flex flex-col"> 
<div class="bg-[var(--card-bg)] p-2 rounded-xl h-full flex flex-col"> 
<h2 class="text-base font-semibold text-white border-b border-[var(--border-color)] pb-1 mb-1">Input</h2> 
<div class="space-y-1.5 flex-grow"> 
<div>
<label class="block text-xs font-medium text-slate-300 mb-0.5">Antall personer</label>
<div class="flex gap-1.5" id="person-count"> 
<button data-value="1" class="person-btn flex-1 bg-blue-600 text-white font-semibold py-0.75 px-2.25 rounded-md text-sm">1 person</button> 
<button data-value="2" class="person-btn flex-1 bg-slate-700 text-slate-300 font-semibold py-0.75 px-2.25 rounded-md text-sm">2 personer</button> 
</div>
</div>
<!-- "Innslagspunkt primærbolig" er fjernet herfra i HTML -->
<div>
<label for="private-debt" class="block text-xs font-medium text-slate-300">Privat gjeld (NOK)</label>
<input type="text" id="private-debt" class="asset-input mt-0.5" value="5 000 000" placeholder="0">
<button id="reset-btn" class="w-full mt-2 bg-[var(--card-bg)] hover:bg-[var(--border-color)] text-slate-300 font-semibold py-1 px-2 rounded-md text-xs transition-colors border border-[var(--border-color)]">Nullstill alt</button>
</div>
</div>
<h3 class="text-sm font-semibold text-white border-b border-[var(--border-color)] pb-1 mt-2 mb-1">Eiendeler</h3> 
<div id="assets-container" class="space-y-0.5 flex-grow overflow-y-auto custom-scrollbar"> 
<!-- Innhold genereres av JS -->
</div> 
</div>
</div>

<!-- Kolonne 2: Resultater og navigasjon -->
<div class="lg:col-span-1 space-y-1.5 flex flex-col"> 
<div class="bg-[var(--card-bg)] p-3 rounded-xl h-full flex flex-col"> <!-- Økt padding for å fylle bedre -->
<h2 class="text-base font-semibold text-white border-b border-[var(--border-color)] pb-1 mb-1">Resultater</h2> 
<div class="text-center bg-slate-900/80 p-4 rounded-lg mb-2"> <!-- Økt padding og mb for å fylle bedre -->
<div id="total-wealth-tax" class="output-value text-2xl">0 kr</div> <!-- Økt til text-2xl -->
<div class="output-label mt-1 text-base">Total Formuesskatt</div> <!-- Økt mt og text-base -->
</div>
<div class="space-y-1.5 bg-slate-800/60 p-3 rounded-lg flex-grow text-sm"> <!-- Økt space-y, padding, og text-size -->
<div class="flex justify-between items-center text-slate-300 text-sm"><span>Bruttoformue:</span><span id="gross-wealth" class="font-semibold text-white">0 kr</span></div><hr class="border-[var(--border-color)]">
<div class="flex justify-between items-center text-slate-300 text-sm"><span>Verdsettelsesrabatt:</span><span id="total-discount" class="font-semibold text-white">0 kr</span></div><hr class="border-[var(--border-color)]">
<div class="flex justify-between items-center text-slate-300 text-sm"><span>Nettoformue (etter rabatt):</span><span id="net-wealth" class="font-semibold text-white">0 kr</span></div><hr class="border-[var(--border-color)]">
<div class="flex justify-between items-center text-slate-300 text-sm"><span>Fradragsberettiget gjeld:</span><span id="deductible-debt" class="font-semibold text-white">0 kr</span></div><hr class="border-[var(--border-color)]">
<div class="flex justify-between items-center text-slate-300 text-sm"><span>Fribeløp:</span><span id="tax-free-allowance" class="font-semibold text-white">0 kr</span></div><hr class="border-[var(--border-color)]">
<div class="flex justify-between items-center text-base text-white"><span class="font-medium">Skattegrunnlag:</span><span id="taxable-base" class="font-bold">0 kr</span></div><hr class="border-[var(--border-color)]"> 
<div class="flex justify-between items-center text-slate-300 mt-1.5 text-sm"><span>Skatteandel av bruttoformue:</span><span id="tax-as-percentage-of-gross" class="font-semibold text-white">0.00 %</span></div> 
</div>
<!-- Navigasjonsknapp til del 2 -->
<div class="mt-auto pt-2 text-center"> 
<button id="goToPage2Btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-1.5 px-2 rounded-lg shadow-md transition-transform transform hover:scale-105 text-sm"> 
Analyser kjøpekraft →
</button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- =========== SIDE 2: KJØPEKRAFTKALKULATOR =========== -->
<div id="page2" class="page">
<div class="dashboard-container w-full flex flex-col items-center justify-center p-4 lg:p-8">
<div class="w-full max-w-6xl mx-auto h-full flex flex-col justify-between"> <!-- Lagt til h-full flex flex-col justify-between for ensartet høyde -->
<header class="text-center mb-1"> 
<h1 class="text-xl md:text-2xl font-bold text-white mb-0.5">Hvilken bankrente må du ha for å gå i null etter skatt?</h1> 
</header>

<div class="grid grid-cols-1 flex-grow"> <!-- Lagt til flex-grow her -->
<div class="bg-[var(--card-bg)] p-2 rounded-xl h-full flex flex-col"> 
<div class="mb-1.5 w-48"> 
<label for="inflation-rate" class="block text-xs font-medium text-slate-300">Forventet inflasjon (%)</label>
<input type="text" id="inflation-rate" class="asset-input mt-0.5" value="3.0">
</div>

<div class="space-y-1.5 flex-grow overflow-y-auto custom-scrollbar"> 
<!-- Privatperson Tabell -->
<div id="private-person-table" class="rate-table-container mb-2"></div> 
                                    
<!-- AS Tabell -->
<div id="as-table" class="rate-table-container rate-table-as"></div>
</div>
</div>
</div>
<!-- Flyttet knappen hit og wrappet i en kolonne for å matche layout på Side 1 -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-2 mt-auto pt-2"> <!-- Nytt grid for knappen -->
<div class="lg:col-span-1"> <!-- Sikrer at knappen tar opp halve bredden på desktop -->
<div class="text-center"> 
<button id="goToPage1Btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-1.5 px-2 rounded-lg shadow-md transition-transform transform hover:scale-105 text-sm"> 
← tilbake til Formuesskatt
</button>
</div>
</div>
<div class="lg:col-span-1 hidden lg:block"> <!-- Dummy kolonne for å fylle den andre halvdelen på desktop -->
<!-- Denne div'en er tom og kun for layout -->
</div>
</div>
</div>
</div>
</div>


    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const sharedData = {
            taxAsPercentageOfGross: 0,
            inflationRate: 3.0,
        };

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if (pageId === 'page2') {
                WealthTaxApp.updatePage2();
            }
        }
        
        // Hendelseslyttere for sidenavigasjonsknapper
        document.getElementById('goToPage2Btn').addEventListener('click', () => showPage('page2'));
        document.getElementById('goToPage1Btn').addEventListener('click', () => showPage('page1'));
        
        // --- APPLIKASJONSOPPSETT ---
        const WealthTaxApp = {
            // Konfigurasjon for ulike eiendelstyper, inkludert etiketter, startverdier og sliderområder.
            assetsConfig: [
                { id: 'primary-residence', label: 'Primærbolig', value: 20000000, min: 0, max: 50000000, step: 100000 },
                { id: 'holiday-home', label: 'Fritidseiendom', value: 3000000, min: 0, max: 20000000, step: 50000 },
                { id: 'land-plot', label: 'Tomt', value: 1000000, min: 0, max: 10000000, step: 50000 },
                { id: 'car-boat', label: 'Bil / Båt', value: 500000, min: 0, max: 5000000, step: 10000 },
                { id: 'limited-company', label: 'Aksjeselskap (AS)', value: 10000000, min: 0, max: 100000000, step: 100000 },
                { id: 'private-portfolio', label: 'Privat portefølje (ASK)', value: 2000000, min: 0, max: 50000000, step: 100000 },
                { id: 'secondary-residence', label: 'Sekundærbolig', value: 4000000, min: 0, max: 30000000, step: 100000 },
                { id: 'bank-deposits', label: 'Bankinnskudd', value: 1500000, min: 0, max: 10000000, step: 50000 },
                { id: 'operating-assets', label: 'Driftsmidler', value: 0, min: 0, max: 20000000, step: 50000 },
            ],
            // Rabattsatser/verdivurderingsfaktorer for ulike eiendelstyper.
            // Disse representerer hvor mye av eiendelens verdi som medregnes i formuegrunnlaget.
            discounts: {
                // For primærbolig: 25% verdivurdering (dvs. 75% rabatt) opp til terskel på 10M, og 70% verdivurdering (dvs. 30% rabatt) over terskel.
                'primary-residence': { valuation_under_threshold: 0.25, valuation_over_threshold: 0.70 },
                'holiday-home': 0.70, // 70% verdivurdering
                'land-plot': 0.70,    // 70% verdivurdering
                'car-boat': 1,        // 100% verdivurdering (0% rabatt)
                'limited-company': 0.80, // 80% verdivurdering (20% rabatt)
                'private-portfolio': 0.80, // 80% verdivurdering (20% rabatt)
                'secondary-residence': 1, // 100% verdivurdering (0% rabatt)
                'bank-deposits': 1,      // 100% verdivurdering (0% rabatt)
                'operating-assets': 0.70, // 70% verdivurdering (30% rabatt)
            },
            // Applikasjonsstatus, f.eks. antall personer for skatteberegninger.
            state: { personCount: 1 },
            
            // Initialiserer applikasjonen: oppretter eiendelsinput-sliders og fester hendelseslyttere.
            init: function() {
                this.createAssetInputs();
                this.attachEventListeners();
                this.calculateAll(); // Utfører første beregning
            },

            // Oppretter dynamisk input-sliders for hver eiendel definert i assetsConfig.
            createAssetInputs: function() {
                const container = document.getElementById('assets-container');
                container.innerHTML = ''; // Tømmer eksisterende innhold
                this.assetsConfig.forEach(asset => {
                    const div = document.createElement('div');
                    div.className = 'asset-slider-group';
                    div.innerHTML = `
                        <div class="flex justify-between items-baseline mb-0"> 
                            <label for="${asset.id}" class="text-xs font-medium text-slate-300">${asset.label}</label>
                            <span id="${asset.id}-value" class="text-xs font-semibold text-[var(--accent-blue-light)]">${this.formatCurrency(asset.value)}</span> 
                        </div>
                        <input type="range" id="${asset.id}" min="${asset.min}" max="${asset.max}" step="${asset.step}" value="${asset.value}">
                    `;
                    container.appendChild(div);
                });
            },

            // Fester hendelseslyttere til input-elementer og personantallknapper.
            attachEventListeners: function() {
                // Hendelseslytter for inputendringer på side 1 (sliders og tekstinput).
                document.getElementById('page1').addEventListener('input', (e) => {
                    if (e.target.type === 'range') {
                        // Oppdater visningsverdi for sliders
                        const valueSpan = document.getElementById(`${e.target.id}-value`);
                        if (valueSpan) {
                            valueSpan.textContent = this.formatCurrency(parseFloat(e.target.value));
                        }
                        this.calculateAll(); // Beregn på nytt når slider endres
                    } else if (e.target.matches('.asset-input, #private-debt')) { 
                        // Formater og beregn på nytt for tekstinput
                        this.formatAndRecalculate(e.target);
                    }
                });

                // Hendelseslytter for inflasjonsrate-input på side 2.
                document.getElementById('inflation-rate').addEventListener('input', (e) => {
                    this.formatAndRecalculate(e.target);
                    this.updatePage2(); // Oppdater side 2-beregningene når inflasjonsraten endres
                });

                // Hendelseslytter for personantallknapper.
                document.getElementById('person-count').addEventListener('click', (e) => {
                    if (e.target.matches('.person-btn')) {
                        this.state.personCount = parseInt(e.target.dataset.value, 10);
                        // Veksle aktiv knappestil
                        document.querySelectorAll('.person-btn').forEach(btn => {
                            btn.classList.toggle('bg-blue-600', btn === e.target);
                            btn.classList.toggle('text-slate-700', btn !== e.target);
                            btn.classList.toggle('text-white', btn === e.target);
                            btn.classList.toggle('text-slate-300', btn !== e.target);
                        });
                        this.calculateAll(); // Beregn på nytt basert på nytt personantall
                    }
                });

                // Hendelseslytter for reset-knappen.
                document.getElementById('reset-btn').addEventListener('click', () => {
                    this.resetAll();
                });
            },

            // Nullstiller alle verdier til standardverdier.
            resetAll: function() {
                // Reset personantall til 1 person
                this.state.personCount = 1;
                document.querySelectorAll('.person-btn').forEach(btn => {
                    if (btn.dataset.value === '1') {
                        btn.classList.add('bg-blue-600', 'text-white');
                        btn.classList.remove('bg-slate-700', 'text-slate-300');
                    } else {
                        btn.classList.add('bg-slate-700', 'text-slate-300');
                        btn.classList.remove('bg-blue-600', 'text-white');
                    }
                });

                // Reset gjeld til 0
                document.getElementById('private-debt').value = '0';

                // Reset alle eiendeler til 0
                this.assetsConfig.forEach(asset => {
                    const slider = document.getElementById(asset.id);
                    if (slider) {
                        slider.value = 0;
                        const valueSpan = document.getElementById(`${asset.id}-value`);
                        if (valueSpan) {
                            valueSpan.textContent = this.formatCurrency(0);
                        }
                    }
                });

                // Beregn på nytt med nullstilte verdier
                this.calculateAll();
            },
            
            // Beregner alle formuesskattkomponenter basert på gjeldende inputverdier.
            calculateAll: function() {
                const values = this.getValues();
                // Fast terskel for primærbolig (tidligere input-felt)
                const primaryResidenceFixedThreshold = 10000000; 

                // Bestemmer skattefritt beløp basert på personantall
                const taxFreeAllowance = this.state.personCount === 1 ? 1700000 : 3400000;
                // Bestemmer terskel for høy sats basert på personantall
                const highRateThreshold = this.state.personCount === 1 ? 20000000 : 40000000;
                // Summerer alle eiendelsverdier for å få bruttoformue
                const grossWealth = Object.values(values.assets).reduce((sum, val) => sum + val, 0);

                let totalValuedWealth = 0; // Summen av eiendeler etter verdivurdering (skattemessig formue)

                Object.keys(values.assets).forEach(key => {
                    const assetValue = values.assets[key];
                    let valuedAmount = assetValue; 

                    if (key === 'primary-residence') {
                        // Primærbolig verdivurderes til 25% opp til terskel, og 70% over terskel
                        const valFactors = this.discounts[key];
                        valuedAmount = (Math.min(assetValue, primaryResidenceFixedThreshold) * valFactors.valuation_under_threshold) +
                                       (Math.max(0, assetValue - primaryResidenceFixedThreshold) * valFactors.valuation_over_threshold);
                    } else {
                        // For andre eiendeler, bruk den definerte verdivurderingsfaktoren
                        // Sjekk om rabatten er et tall, ellers bruk 1 for 100% verdivurdering
                        valuedAmount = assetValue * (typeof this.discounts[key] === 'number' ? this.discounts[key] : 1); 
                    }
                    totalValuedWealth += valuedAmount;
                });
                
                // totalDiscount er differansen mellom bruttoformue og skattemessig formue
                const totalDiscount = grossWealth - totalValuedWealth; 
                
                // Nettoformue er den skattemessige formuen
                const netWealth = totalValuedWealth; 

                // Fradragsberettiget gjeld er proporsjonal med skattemessig formue
                const proportionalDebtShare = grossWealth > 0 ? totalValuedWealth / grossWealth : 0;
                const deductibleDebt = values.privateDebt * proportionalDebtShare;

                // Skattegrunnlaget er nettoformue minus fribeløp og fradragsberettiget gjeld
                const taxableBase = Math.max(0, netWealth - taxFreeAllowance - deductibleDebt);
                // Total formuesskatt beregnes basert på progressive satser
                const totalWealthTax = (Math.min(taxableBase, highRateThreshold) * 0.01) + (Math.max(0, taxableBase - highRateThreshold) * 0.011);
                
                sharedData.taxAsPercentageOfGross = grossWealth > 0 ? (totalWealthTax / grossWealth) : 0;
                sharedData.inflationRate = values.inflationRate;

                this.updatePage1UI({grossWealth, totalDiscount, netWealth, deductibleDebt, taxFreeAllowance, taxableBase, totalWealthTax});
            },
            
            // Oppdaterer visningselementene på side 1 med beregnede resultater.
            updatePage1UI: function(results) {
                document.getElementById('gross-wealth').textContent = this.formatCurrency(results.grossWealth);
                document.getElementById('total-discount').textContent = this.formatCurrency(results.totalDiscount);
                document.getElementById('net-wealth').textContent = this.formatCurrency(results.netWealth);
                document.getElementById('deductible-debt').textContent = this.formatCurrency(results.deductibleDebt);
                document.getElementById('tax-free-allowance').textContent = this.formatCurrency(results.taxFreeAllowance);
                document.getElementById('taxable-base').textContent = this.formatCurrency(results.taxableBase);
                document.getElementById('total-wealth-tax').textContent = this.formatCurrency(results.totalWealthTax);
                document.getElementById('tax-as-percentage-of-gross').textContent = `${(sharedData.taxAsPercentageOfGross * 100).toFixed(2)} %`;
            },

            // Oppdaterer tabellene på side 2 med kjøpekraftanalyse.
            updatePage2: function() {
                const inflation = sharedData.inflationRate / 100;
                const capitalGainsTax = 0.22;
                const dividendTax = 0.378;

                // Definerer ulike formuesskattscenarier
                const wealthTaxRates = {
                    'Ingen': 0, 'Lav': 0.01, 'Høy': 0.011, 'Faktisk': sharedData.taxAsPercentageOfGross
                };

                const privateRates = {}; // Satser for privatpersoner
                const asRates = {}; // Satser for Aksjeselskap (AS)
                
                // Beregn minimum nødvendig bankrente for hvert scenario
                for (const [label, taxRate] of Object.entries(wealthTaxRates)) {
                    privateRates[label] = {
                        capital: capitalGainsTax, dividend: 0, wealth: taxRate, inflation: inflation,
                        // Formel for minimum rente for privatpersoner
                        minInterest: ((inflation + taxRate) / (1 - capitalGainsTax)) * 100
                    };
                    asRates[label] = {
                        capital: capitalGainsTax, dividend: dividendTax, wealth: taxRate, inflation: inflation,
                        // Formel for minimum rente for AS (tar hensyn til både kapitalgevinster og utbytteskatt)
                        minInterest: (((inflation + taxRate) / (1 - dividendTax)) / (1 - capitalGainsTax)) * 100
                    };
                }
                
                // Fyller ut tabellene i UI
                document.getElementById('private-person-table').innerHTML = this.generateRateTable('Privat', privateRates);
                document.getElementById('as-table').innerHTML = this.generateRateTable('AS', asRates);
            },
            
            // Genererer HTML-tabellen for visning av skattesatser og minimum nødvendig rente.
            generateRateTable: function(title, data) {
                const headers = Object.keys(data); 
                let tableHTML = `<h3 class="text-base font-semibold text-white mb-1.5">${title}</h3>`; 
                
                // Tabellhode-rad
                tableHTML += `<div class="rate-table-header"><div></div>${headers.map(h => `<div class="rate-table-cell">${h}</div>`).join('')}</div>`;

                // Data rader for Kapitalskatt, Utbytteskatt, Formuesskatt, Inflasjon
                const rows = [
                    { label: 'Kapitalskatt', key: 'capital' },
                    { label: 'Utbytteskatt', key: 'dividend' },
                    { label: 'Formuesskatt', key: 'wealth' },
                    { label: 'Inflasjon', key: 'inflation' },
                ];

                rows.forEach(row => {
                    tableHTML += `<div class="rate-table-row">
                        <div class="rate-table-row-label">${row.label}</div>
                        ${headers.map(h => `<div class="rate-table-cell">${(data[h][row.key] * 100).toFixed(2)} %</div>`).join('')}
                    </div>`;
                });
                
                // Siste rad for Minimum Bankrente
                tableHTML += `<div class="rate-table-row rate-table-final-row">
                    <div class="rate-table-row-label">Minimum bankrente</div>
                    ${headers.map(h => `<div class="rate-table-cell">${data[h].minInterest.toFixed(2)} %</div>`).join('')}
                </div>`;

                return tableHTML;
            },

            // Henter alle gjeldende inputverdier fra sliders og tekstfelter.
            getValues: function() {
                const values = { assets: {} };
                // Henter verdier fra sliders for eiendeler
                this.assetsConfig.forEach(asset => {
                    const slider = document.getElementById(asset.id);
                    if (slider) {
                        values.assets[asset.id] = parseFloat(slider.value);
                    }
                });
                // Henter verdier fra tekstinput, parser dem til tall
                values.privateDebt = this.parseNumber(document.getElementById('private-debt').value);
                values.inflationRate = this.parseNumber(document.getElementById('inflation-rate').value, true); 
                return values;
            },
            
            // Formaterer et nummerinput (f.eks. legger til tusenskillere) og utløser ny beregning.
            formatAndRecalculate: function(element) {
                const isFloat = element.id === 'inflation-rate';
                const numericValue = this.parseNumber(element.value, isFloat);
                element.value = isFloat ? String(numericValue) : this.formatNumber(numericValue);
                this.calculateAll(); 
            },

            // Parser en streng til et tall, håndterer lokalespesifikke skilletegn.
            parseNumber: (str, isFloat = false) => {
                if (typeof str !== 'string') return isNaN(str) ? 0 : str;
                const cleaned = str.replace(/[^\d,.]/g, '').replace(',', '.');
                const val = isFloat ? parseFloat(cleaned) : parseInt(cleaned, 10);
                return isNaN(val) ? 0 : val;
            },
            
            // Formaterer et tall med norske lokaler tusenskillere.
            formatNumber: (num) => new Intl.NumberFormat('nb-NO').format(isNaN(num) ? 0 : num),
            // Formaterer et tall som norske kroner valuta, uten desimaler.
            formatCurrency: (num) => new Intl.NumberFormat('nb-NO', { style: 'currency', currency: 'NOK', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(isNaN(num) ? 0 : num),
        };
        
        // Initialiserer applikasjonen når DOM er fullastet.
        WealthTaxApp.init();
    });
    </script>
    <script src="script.js"></script>
</body>
</html>
