<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator for Formuesskatt</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- General Styles --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #E5E7EB; /* light-text */
        }

        /* --- Page Navigation --- */
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }

        /* --- Dashboard Specific Styles --- */
        .dashboard-container {
            --dark-blue: #1A2A47;
            --accent-blue-light: #60A5FA;
            --accent-blue-vibrant: #00A9E0;
            --card-bg: #24385B;
            --light-text: #E5E7EB;
            --medium-text: #CBD5E1;
            --border-color: #364A6E;
            background-color: var(--dark-blue);
        }
        
        /* Style for the main output values */
        .output-value {
            font-size: 2rem; /* text-3xl */
            font-weight: 700;
            color: var(--accent-blue-vibrant);
            word-break: break-word;
        }

        .output-label {
            font-size: 0.9rem; /* text-sm */
            color: var(--medium-text);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Common Number Input Style */
        input[type="text"].asset-input {
            -moz-appearance: textfield;
            background-color: #1e293b; /* slate-800 */
            border: 1px solid var(--border-color);
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 0.75rem;
            color: var(--light-text);
            width: 100%;
        }
        input[type="text"].asset-input:focus {
            outline: none;
            border-color: var(--accent-blue-light);
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.5);
        }
        input[type="text"].asset-input::placeholder {
            color: #475569; /* slate-600 */
        }
        
        /* --- Slider Styles --- */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #1e293b; /* slate-800 */
            border-radius: 5px;
            outline: none;
            transition: background 0.3s, opacity 0.2s;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-blue-light);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--dark-blue);
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--accent-blue-light);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--dark-blue);
        }
        
        /* Page 2 Table Styles */
        .rate-table-container {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 0.75rem;
        }
        .rate-table-as {
             background-color: #1e3a8a; /* A darker blue for AS section */
        }
        .rate-table-header {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            color: var(--medium-text);
            font-weight: 600;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .rate-table-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        .rate-table-row:last-child {
            border-bottom: none;
        }
        .rate-table-row-label {
            font-weight: 500;
            color: var(--light-text);
        }
        .rate-table-cell {
            text-align: right;
        }
        .rate-table-final-row {
            font-size: 1.125rem;
            font-weight: 700;
            color: white;
            background-color: rgba(0, 0, 0, 0.2);
            margin: 0 -1.5rem; /* Extend background */
            padding: 0.75rem 1.5rem; /* Restore padding */
        }

    </style>
</head>
<body class="antialiased">

    <!-- =========== PAGE 1: WEALTH TAX CALCULATOR =========== -->
    <div id="page1" class="page active">
        <div class="dashboard-container min-h-screen flex flex-col items-center justify-center p-4 lg:p-8">
            <div class="w-full max-w-7xl mx-auto">
                <header class="text-center mb-8">
                    <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">Beregning av Formuesskatt</h1>
                    <p class="text-slate-400">Beregn din formuesskatt og se hva som kreves for å bevare kjøpekraften.</p>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Column 1: Input -->
                    <div class="lg:col-span-1 space-y-6">
                        <div class="bg-[var(--card-bg)] p-6 rounded-xl h-full">
                            <h2 class="text-2xl font-semibold text-white border-b border-[var(--border-color)] pb-3 mb-4">Input</h2>
                            <div class="space-y-5">
                               <div>
                                   <label class="block text-sm font-medium text-slate-300 mb-2">Antall personer</label>
                                   <div class="flex gap-2" id="person-count">
                                       <button data-value="1" class="person-btn flex-1 bg-blue-600 text-white font-semibold py-2 px-4 rounded-md">1 person</button>
                                       <button data-value="2" class="person-btn flex-1 bg-slate-700 text-slate-300 font-semibold py-2 px-4 rounded-md">2 personer</button>
                                   </div>
                               </div>
                               <div>
                                   <label for="primary-residence-threshold" class="block text-sm font-medium text-slate-300">Innslagspunkt primærbolig (NOK)</label>
                                   <input type="text" id="primary-residence-threshold" class="asset-input mt-1" value="10 000 000">
                               </div>
                               <div>
                                   <label for="private-debt" class="block text-sm font-medium text-slate-300">Privat gjeld (NOK)</label>
                                   <input type="text" id="private-debt" class="asset-input mt-1" value="5 000 000" placeholder="0">
                               </div>
                            </div>
                            <h3 class="text-xl font-semibold text-white border-b border-[var(--border-color)] pb-3 mt-8 mb-4">Eiendeler</h3>
                            <div id="assets-container" class="space-y-4"></div>
                        </div>
                    </div>

                    <!-- Column 2: Results & Navigation -->
                    <div class="lg:col-span-1 space-y-6">
                         <div class="bg-[var(--card-bg)] p-6 rounded-xl h-full flex flex-col">
                            <h2 class="text-2xl font-semibold text-white border-b border-[var(--border-color)] pb-3 mb-4">Resultater</h2>
                            <div class="text-center bg-slate-900/80 p-6 rounded-lg mb-6">
                                <div id="total-wealth-tax" class="output-value">0 kr</div>
                                <div class="output-label mt-2">Total Formuesskatt</div>
                            </div>
                            <div class="space-y-3 bg-slate-800/60 p-4 rounded-lg flex-grow">
                                <div class="flex justify-between items-center text-slate-300"><span>Bruttoformue:</span><span id="gross-wealth" class="font-semibold text-white">0 kr</span></div><hr class="border-[var(--border-color)]">
                                <div class="flex justify-between items-center text-slate-300"><span>Verdsettelsesrabatt:</span><span id="total-discount" class="font-semibold text-white">0 kr</span></div><hr class="border-[var(--border-color)]">
                                <div class="flex justify-between items-center text-slate-300"><span>Nettoformue (etter rabatt):</span><span id="net-wealth" class="font-semibold text-white">0 kr</span></div><hr class="border-[var(--border-color)]">
                                <div class="flex justify-between items-center text-slate-300"><span>Fradragsberettiget gjeld:</span><span id="deductible-debt" class="font-semibold text-white">0 kr</span></div><hr class="border-[var(--border-color)]">
                                <div class="flex justify-between items-center text-slate-300"><span>Fribeløp:</span><span id="tax-free-allowance" class="font-semibold text-white">0 kr</span></div><hr class="border-[var(--border-color)]">
                                <div class="flex justify-between items-center text-lg text-white"><span class="font-medium">Skattegrunnlag:</span><span id="taxable-base" class="font-bold">0 kr</span></div><hr class="border-[var(--border-color)]">
                                <div class="flex justify-between items-center text-slate-300 mt-4"><span>Skatteandel av bruttoformue:</span><span id="tax-as-percentage-of-gross" class="font-semibold text-white">0.00 %</span></div>
                            </div>
                             <!-- Navigation Button to Part 2 -->
                            <div class="mt-auto pt-6 text-center">
                                <button id="goToPage2Btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                                    Analyser kjøpekraft →
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- =========== PAGE 2: PURCHASING POWER CALCULATOR =========== -->
    <div id="page2" class="page">
        <div class="dashboard-container min-h-screen flex flex-col items-center justify-center p-4 lg:p-8">
            <div class="w-full max-w-7xl mx-auto">
                 <header class="text-center mb-8">
                    <h1 class="text-2xl md:text-3xl font-bold text-white">Hvilken bankrente må du ha for å gå i null etter skatt?</h1>
                </header>

                <div class="grid grid-cols-1">
                     <div class="bg-[var(--card-bg)] p-6 rounded-xl h-full flex flex-col">
                        <div class="mb-6 w-48">
                             <label for="inflation-rate" class="block text-sm font-medium text-slate-300">Forventet inflasjon (%)</label>
                             <input type="text" id="inflation-rate" class="asset-input mt-1" value="3.0">
                        </div>
                        
                        <div class="space-y-8 flex-grow">
                            <!-- Privatperson Table -->
                            <div id="private-person-table" class="rate-table-container"></div>
                            
                            <!-- AS Table -->
                            <div id="as-table" class="rate-table-container rate-table-as"></div>
                        </div>

                        <!-- Button moved here -->
                        <div class="mt-auto pt-6 text-center">
                            <button id="goToPage1Btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                                ← tilbake til Formuesskatt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const sharedData = {
            taxAsPercentageOfGross: 0,
            inflationRate: 3.0,
        };

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if (pageId === 'page2') {
                WealthTaxApp.updatePage2();
            }
        }
        
        document.getElementById('goToPage2Btn').addEventListener('click', () => showPage('page2'));
        document.getElementById('goToPage1Btn').addEventListener('click', () => showPage('page1'));
        
        // --- APPLICATION SETUP ---
        const WealthTaxApp = {
            assetsConfig: [
                { id: 'primary-residence', label: 'Primærbolig', value: 20000000, min: 0, max: 50000000, step: 100000 },
                { id: 'holiday-home', label: 'Fritidseiendom', value: 3000000, min: 0, max: 20000000, step: 50000 },
                { id: 'land-plot', label: 'Tomt', value: 1000000, min: 0, max: 10000000, step: 50000 },
                { id: 'car-boat', label: 'Bil / Båt', value: 500000, min: 0, max: 5000000, step: 10000 },
                { id: 'limited-company', label: 'Aksjeselskap (AS)', value: 10000000, min: 0, max: 100000000, step: 100000 },
                { id: 'private-portfolio', label: 'Privat portefølje (ASK)', value: 2000000, min: 0, max: 50000000, step: 100000 },
                { id: 'secondary-residence', label: 'Sekundærbolig', value: 4000000, min: 0, max: 30000000, step: 100000 },
                { id: 'bank-deposits', label: 'Bankinnskudd', value: 1500000, min: 0, max: 10000000, step: 50000 },
                { id: 'operating-assets', label: 'Driftsmidler', value: 0, min: 0, max: 20000000, step: 50000 },
            ],
            discounts: {
                'primary-residence': { under_threshold: 0.75, over_threshold: 0.30 },
                'holiday-home': 0.70, 'land-plot': 0.70, 'car-boat': 0, 'limited-company': 0.20,
                'private-portfolio': 0.20, 'secondary-residence': 0, 'bank-deposits': 0, 'operating-assets': 0.30,
            },
            state: { personCount: 1 },
            
            init: function() {
                this.createAssetInputs();
                this.attachEventListeners();
                this.calculateAll();
            },

            createAssetInputs: function() {
                const container = document.getElementById('assets-container');
                container.innerHTML = ''; // Clear existing content
                this.assetsConfig.forEach(asset => {
                    const div = document.createElement('div');
                    div.className = 'asset-slider-group';
                    div.innerHTML = `
                        <div class="flex justify-between items-baseline mb-2">
                            <label for="${asset.id}" class="text-sm font-medium text-slate-300">${asset.label}</label>
                            <span id="${asset.id}-value" class="text-base font-semibold text-[var(--accent-blue-light)]">${this.formatCurrency(asset.value)}</span>
                        </div>
                        <input type="range" id="${asset.id}" min="${asset.min}" max="${asset.max}" step="${asset.step}" value="${asset.value}">
                    `;
                    container.appendChild(div);
                });
            },

            attachEventListeners: function() {
                document.getElementById('page1').addEventListener('input', (e) => {
                    if (e.target.type === 'range') {
                        const valueSpan = document.getElementById(`${e.target.id}-value`);
                        if (valueSpan) {
                            valueSpan.textContent = this.formatCurrency(parseFloat(e.target.value));
                        }
                        this.calculateAll();
                    } else if (e.target.matches('.asset-input, #private-debt, #primary-residence-threshold')) {
                        this.formatAndRecalculate(e.target);
                    }
                });

                document.getElementById('inflation-rate').addEventListener('input', (e) => {
                    this.formatAndRecalculate(e.target);
                    this.updatePage2();
                });

                document.getElementById('person-count').addEventListener('click', (e) => {
                    if (e.target.matches('.person-btn')) {
                        this.state.personCount = parseInt(e.target.dataset.value, 10);
                        document.querySelectorAll('.person-btn').forEach(btn => {
                            btn.classList.toggle('bg-blue-600', btn === e.target);
                            btn.classList.toggle('text-white', btn === e.target);
                            btn.classList.toggle('bg-slate-700', btn !== e.target);
                            btn.classList.toggle('text-slate-300', btn !== e.target);
                        });
                        this.calculateAll();
                    }
                });
            },
            
            calculateAll: function() {
                const values = this.getValues();
                const taxFreeAllowance = this.state.personCount === 1 ? 1700000 : 3400000;
                const highRateThreshold = this.state.personCount === 1 ? 20000000 : 40000000;
                const grossWealth = Object.values(values.assets).reduce((sum, val) => sum + val, 0);

                let totalDiscount = 0, discountForDebtCalc = 0;
                Object.keys(values.assets).forEach(key => {
                    const assetValue = values.assets[key];
                    let currentDiscount = 0;
                    if (key === 'primary-residence') {
                        const threshold = values.primaryResidenceThreshold;
                        currentDiscount = (Math.min(assetValue, threshold) * this.discounts[key].under_threshold) + (Math.max(0, assetValue - threshold) * this.discounts[key].over_threshold);
                    } else {
                        currentDiscount = assetValue * (this.discounts[key] || 0);
                        discountForDebtCalc += currentDiscount;
                    }
                    totalDiscount += currentDiscount;
                });
                
                const netWealth = grossWealth - totalDiscount;
                const debtReduction = grossWealth > 0 ? values.privateDebt * (discountForDebtCalc / grossWealth) : 0;
                const deductibleDebt = Math.max(0, values.privateDebt - debtReduction);
                const taxableBase = Math.max(0, netWealth - taxFreeAllowance - deductibleDebt);
                const totalWealthTax = (Math.min(taxableBase, highRateThreshold) * 0.01) + (Math.max(0, taxableBase - highRateThreshold) * 0.011);
                
                sharedData.taxAsPercentageOfGross = grossWealth > 0 ? (totalWealthTax / grossWealth) : 0;
                sharedData.inflationRate = values.inflationRate;

                this.updatePage1UI({grossWealth, totalDiscount, netWealth, deductibleDebt, taxFreeAllowance, taxableBase, totalWealthTax});
            },
            
            updatePage1UI: function(results) {
                document.getElementById('gross-wealth').textContent = this.formatCurrency(results.grossWealth);
                document.getElementById('total-discount').textContent = this.formatCurrency(results.totalDiscount);
                document.getElementById('net-wealth').textContent = this.formatCurrency(results.netWealth);
                document.getElementById('deductible-debt').textContent = this.formatCurrency(results.deductibleDebt);
                document.getElementById('tax-free-allowance').textContent = this.formatCurrency(results.taxFreeAllowance);
                document.getElementById('taxable-base').textContent = this.formatCurrency(results.taxableBase);
                document.getElementById('total-wealth-tax').textContent = this.formatCurrency(results.totalWealthTax);
                document.getElementById('tax-as-percentage-of-gross').textContent = `${(sharedData.taxAsPercentageOfGross * 100).toFixed(2)} %`;
            },

            updatePage2: function() {
                const inflation = sharedData.inflationRate / 100;
                const capitalGainsTax = 0.22;
                const dividendTax = 0.378;

                const wealthTaxRates = {
                    'Ingen': 0, 'Lav': 0.01, 'Høy': 0.011, 'Faktisk': sharedData.taxAsPercentageOfGross
                };

                const privateRates = {}, asRates = {};
                
                for (const [label, taxRate] of Object.entries(wealthTaxRates)) {
                    privateRates[label] = {
                        capital: capitalGainsTax, dividend: 0, wealth: taxRate, inflation: inflation,
                        minInterest: ((inflation + taxRate) / (1 - capitalGainsTax)) * 100
                    };
                    asRates[label] = {
                        capital: capitalGainsTax, dividend: dividendTax, wealth: taxRate, inflation: inflation,
                        minInterest: (((inflation + taxRate) / (1 - dividendTax)) / (1 - capitalGainsTax)) * 100
                    };
                }
                
                document.getElementById('private-person-table').innerHTML = this.generateRateTable('Privat', privateRates);
                document.getElementById('as-table').innerHTML = this.generateRateTable('AS', asRates);
            },
            
            generateRateTable: function(title, data) {
                 const headers = Object.keys(data); // Ingen, Lav, Høy, Faktisk
                 let tableHTML = `<h3 class="text-2xl font-semibold text-white mb-4">${title}</h3>`;
                 
                 tableHTML += `<div class="rate-table-header"><div></div>${headers.map(h => `<div class="rate-table-cell">${h}</div>`).join('')}</div>`;

                 const rows = [
                     { label: 'Kapitalskatt', key: 'capital' },
                     { label: 'Utbytteskatt', key: 'dividend' },
                     { label: 'Formuesskatt', key: 'wealth' },
                     { label: 'Inflasjon', key: 'inflation' },
                 ];

                 rows.forEach(row => {
                     tableHTML += `<div class="rate-table-row">
                        <div class="rate-table-row-label">${row.label}</div>
                        ${headers.map(h => `<div class="rate-table-cell">${(data[h][row.key] * 100).toFixed(2)} %</div>`).join('')}
                     </div>`;
                 });
                 
                 tableHTML += `<div class="rate-table-row rate-table-final-row">
                    <div class="rate-table-row-label">Minimum bankrente</div>
                    ${headers.map(h => `<div class="rate-table-cell">${data[h].minInterest.toFixed(2)} %</div>`).join('')}
                 </div>`;

                 return tableHTML;
            },

            getValues: function() {
                const values = { assets: {} };
                // Get values from sliders
                this.assetsConfig.forEach(asset => {
                    const slider = document.getElementById(asset.id);
                    if (slider) {
                        values.assets[asset.id] = parseFloat(slider.value);
                    }
                });
                // Get values from text inputs
                values.privateDebt = this.parseNumber(document.getElementById('private-debt').value);
                values.primaryResidenceThreshold = this.parseNumber(document.getElementById('primary-residence-threshold').value);
                values.inflationRate = this.parseNumber(document.getElementById('inflation-rate').value, true);
                return values;
            },
            
            formatAndRecalculate: function(element) {
                const isFloat = element.id === 'inflation-rate';
                const numericValue = this.parseNumber(element.value, isFloat);
                element.value = isFloat ? String(numericValue) : this.formatNumber(numericValue);
                this.calculateAll();
            },

            parseNumber: (str, isFloat = false) => {
                if (typeof str !== 'string') return isNaN(str) ? 0 : str;
                const cleaned = str.replace(/[^\d,.]/g, '').replace(',', '.');
                const val = isFloat ? parseFloat(cleaned) : parseInt(cleaned, 10);
                return isNaN(val) ? 0 : val;
            },
            
            formatNumber: (num) => new Intl.NumberFormat('nb-NO').format(isNaN(num) ? 0 : num),
            formatCurrency: (num) => new Intl.NumberFormat('nb-NO', { style: 'currency', currency: 'NOK', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(isNaN(num) ? 0 : num),
        };
        
        WealthTaxApp.init();
    });
    </script>
</body>
</html>
